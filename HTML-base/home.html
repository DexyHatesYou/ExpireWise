<!DOCTYPE html>
<html>
<head>
   
   <script src="https://kit.fontawesome.com/2fd69ec569.js" crossorigin="anonymous"></script>
  <style>
    @font-face { font-family: g; src: url('hwyuenei64.ttf'); }
      
.container, .blur1, .blur2, .segment {
    max-width: 100%;
    overflow-x: hidden;
}

    html, body {
    max-width: 100%;
    overflow-x: hidden;
    max-height: 100%;
    overflow-y: hidden;
}


      .g{
        font-family: g;
      }

      body {
        max-width: 100vv;
        overflow-x: hidden;
      background-color: #BFCBCE;
      overflow-x: hidden;
      overflow: hidden;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      background: rgb(86,91,117);
      background: linear-gradient(180deg, rgba(86,91,117,1) 0%, rgba(191,203,206,1) 12%);
    }

    .load{
      animation: load 0.6s ease-in forwards;
    }

    .unload{
      animation: unload 0.6s ease-in forwards;
    }

    @keyframes load {
      from { opacity: 0%; }
      to { opacity: 100% } 
    }

  @keyframes unload {
      from { opacity: 100%; }
      to { opacity: 0% } 
    }

    .d2 {
      opacity: 0;
    }

  input:focus {
       outline: 2px dashed #303655;  
       box-shadow: inset 0 0 0 2px white;
    }

    .searchBar {
      position: absolute;
      width: 50%;
      height: 6%;
      border-radius: 50px;
      padding-left: 5%;
      left: 5%;
      font-size: 140%;
      top: 8%;
    }

  .filter{
    height: 6.5%;
    aspect-ratio: 1 / 1;
    position: absolute;
    top: 8%;
    left: 64%;
    border-radius: 50px;
  }

    .sort{
    height: 6.5%;
    aspect-ratio: 1 / 1;
    position: absolute;
    top: 8%;
    left: 81%;
    border-radius: 50px;
  }

.container {
    border-top: 3%;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    height: 69%;
    overflow-y: scroll;
    scrollbar-width: none;
    position: absolute;
    top: 13%;
    z-index: 2;
        max-width: 100%;
    overflow-x: hidden;
}
.segment {
    width: 90%;
    height: 22%;
    margin: 0 auto 10px;
    background-color: white;
    border-radius: 25px;
    box-shadow: 0px 0px 10px 0px #888888;
    display: flex;
        max-width: 100%;
    overflow-x: hidden;
    z-index: 30%;
    cursor: pointer;
}



.blur1 {
  width: 120%;
  height: 5%;
  background-color: #BFCBCE;
  position: absolute;
  box-shadow: 0px 0px 20px 20px #BFCBCE;
  z-index: 5;
  top: 11%;
}

.blur2 {
  width: 120%;
  height: 7%;
  background-color: #BFCBCE;
  position: absolute;
  box-shadow: 0px 0px 20px 20px #BFCBCE;
  z-index: 18;
  top: 78%;
}

.topBar {
  z-index: 200;
}

.rcp-img {
  padding: -3px;
  height: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 24px 0px 0px 24px;
  mask-image: linear-gradient(to right, rgba(0, 0, 0, 1) 70%, rgba(0, 0, 0, 0));
  object-fit: cover;
}

.rcp-name {
  color:  #7DA7BD;
  margin-top: 10px;
  margin-bottom: 5px;
  text-decoration: underline;
  text-decoration-thickness: 2px;
  white-space: nowrap;
}



.mark{
  font-size: 90%;
  background-color: #BFCBCE;
  color: white;
  padding: 2px 10px 2px 10px;
  border-radius: 50px;
  border-top: 15px;
}

.seafood{
  background-color: #7DA7BD;
}

.ingr{
  background-color: #8e9a9e;
}

.war{
  background-color: red;
}

.spacer{
  font-size: 50%;
}

.dexp{
  right: 10%;
  position: absolute;

  font-size: 80%;
}

.dleft{
  font-size: 110%;
  color: #a57878;
}





            .nav{
      position: absolute;
      bottom: 5%;
      width: 90%;
      height: 13%;
      display: flex;
      align-items: center;
      align-self: center;
      z-index: 20;
    }

    .r{
      width: 45%;
      height: 60%;
      background-color: white;
      position: absolute;
      left: 5%;
      border-radius: 500px;
    }

    .c{
      height: 100%;
      aspect-ratio: 1/1;
      background-color: white;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 500px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
      z-index: 2;
    }

    .ct{
      height: 100%;
      aspect-ratio: 1/1;
      background-color: white;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 500px;
      z-index: 22;
    }

    .l{
      width: 45%;
      height: 60%;
      background-color: white;
      position: absolute;
      right: 5%;
      border-radius: 500px;
    }

    .b12{
      position: absolute;
      height: 50%;
      width: 100%;
      bottom: -30%;
      background-color: #BFCBCE;
      z-index: 6;
    }

    .b22{
      position: absolute;
      height: 50%;
      width: 100%;
      bottom: 80%;
      background-color: #BFCBCE;
      z-index: 5;
    }

    .ca{
      position: absolute;
      left: 15%;
      bottom: 12%;
    }

    .us{
      position: absolute;
      right: 15%;
      bottom: 6.5%;
    }

    .re{
      position: absolute;
      left: 14.5%;
      bottom: 15%;
    }

    .c0{
      opacity: 0%;
    }

.r .c0 {
  transition: opacity 0.3s ease;
}

.r:hover .c0 {
opacity: 100%;
}

.l .c0 {
  transition: opacity 0.3s ease;
}

.l:hover .c0 {
opacity: 100%;
}

.ct .c0 {
  transition: opacity 0.3s ease;
}

.ct:hover .c0 {
opacity: 100%;
}
.body {
  width: 100%;
  height: 100%;
  display: flex;
        justify-content: center;
      align-items: center;
      opacity: 100%;
overflow-x: hidden;
               
   transition: opacity .5s;
   max-width: 100vv;
}
        #date {
      color: white;
      position: absolute;
      top: 1%;
      left: 6%;
      font-size: 130%;
    }
  </style>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ExpireWise</title>
  <link rel="stylesheet" href="food-labels.css">
</head>
<body class="g">
  <p id="date" class="g"></p>
  <g class="body load">
<div class="topBar">
<input type="text" name="search" class="searchBar g">
<button class="filter"></button>
<button class="sort"></button>
</div>
<div class="blur1"></div>
<div class="container">
  <br><br>

  <div class="segment" onclick="transitionToPage('./recipe.html')">
    <img class="rcp-img" src="https://www.themealdb.com/images/media/meals/7n8su21699013057.jpg" alt="recipe photo">
    <div class="rcp-part">
    <h3 class="rcp-name">Fish Soup (Ukha)</h3>
    <span class="mark seafood">Seafood</span>
    <span class="mark">Russian</span><br><p class="spacer"></p>
    <span class="mark ingr">9 ingredients</span>
    <span class="mark war">2!</span><br><p class="spacer"></p>
    <span class="dexp">Expires in:<span class="dleft">&nbsp;2 Days</span></span>
  </div>
  </div>

</div>
<div class="blur2"></div>
</g>


<div class="nav">
  <div class="b12"></div>
  <div class="r" onclick="transitionToPage('./calendar.html')">
    <img width="45" class="ca" src="https://img.icons8.com/BFCBCE/stamp/100/calendar.png" alt="calendar"/>
     <img width="45" class="ca c0" src="https://img.icons8.com/6f90af/stamp/100/calendar.png" alt="calendar"/>

  </div>
  <div class="c"></div>
  <div class="ct" onclick="recipes()">
    <img width="70" class="re" src="https://img.icons8.com/6F90AF//ios-glyphs/100/cooking-book.png" alt="cooking-book"/>
        <img width="70" class="re c0" src="https://img.icons8.com/84A7BA/ios-glyphs/100/cooking-book.png" alt="cooking-book"/>
  </div>
  <div class="l" onclick="transitionToPage('./profile.html')">
    <img width="50" class="us" src="https://img.icons8.com/BFCBCE/ios-glyphs/100/user-male-circle.png" alt="user-male-circle"/>
        <img width="50" class="us c0" src="https://img.icons8.com/6f90af/ios-glyphs/100/user-male-circle.png" alt="user-male-circle"/>
  </div>
  <div class="b22"></div>
</div>
<script src="date.js"></script>
</body>
<script>
async function checkSession() {
  console.log("Checking session...");
  try {
    const response = await fetch('https://expirewise.localto.net/api/check_session.php', {
      credentials: 'include'
    });
    console.log("Response received");

    const result = await response.json();
    console.log(result);

    if (result.loggedIn) {
      alert(result.nickname);
    } else {
      alert('You are not logged in!');
      window.location.href = 'index.html';
    }
  } catch (error) {
    console.error("Error:", error);
  }
}

checkSession();





var rnd = 0;
const container = document.querySelector('.container');

window.transitionToPage = function(href) {
    document.querySelector('.body').style.opacity = 0
    setTimeout(function() { 
        window.location.href = href
    }, 500)
}

document.addEventListener('DOMContentLoaded', function(event) {
    document.querySelector('.body').style.opacity = 1
})

async function getMeals() {
  try {
    
    //rework, just flour recipes for now
    var respApi = await fetch('https://www.themealdb.com/api/json/v1/1/filter.php?i=flour');
    var data = await respApi.json();

    
    for (const meal of data.meals) {
      const detailResp = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${meal.idMeal}`);
      const detailData = await detailResp.json();
      const mealDetails = detailData.meals[0];

      // Counting ingrs 
      let ingredientCount = 0;
      for (let i = 1; i <= 20; i++) {
        if (mealDetails[`strIngredient${i}`]) {
          ingredientCount++;
        }
      }

      //REWORK!!! just random for now.
      rnd = Math.floor(Math.random() * (6 - 0 + 1)) + 0;
      
      const segment = document.createElement('div');
      segment.classList.add('segment');
      segment.setAttribute('onclick', `openrecipe(${meal.idMeal})`);

      segment.innerHTML = `
        <img class="rcp-img" src="${meal.strMealThumb}" alt="recipe photo">
        <div class="rcp-part onclick="openrecipe(${meal.idMeal})">
          <h3 class="rcp-name">${meal.strMeal}</h3>
          <span class="mark ${mealDetails.strCategory.toLowerCase()}">${mealDetails.strCategory}</span>
          <span class="mark">${mealDetails.strArea}</span><br><p class="spacer"></p>
          <span class="mark ingr">${ingredientCount} ingredients</span>
          <span class="mark war">${rnd}!</span><br><p class="spacer"></p>
          <span class="dexp">Expires in:<span class="dleft">&nbsp;2 Days</span></span>
        </div>
      `;

      
      container.appendChild(segment);
    }
  } catch (error) {
    console.error(error);
  }
}

getMeals();

function openrecipe(id) {
    window.location.href = `recipes.html?id=${id}`;
     }

</script>
</html>