<!DOCTYPE html>
<html>
<head>
  <script src="https://kit.fontawesome.com/2fd69ec569.js" crossorigin="anonymous"></script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="storage.css">
	<title>ExpireWise</title>
</head>
<body>

<p id="date" class="g"></p>
<g class="body">
<div class="top">
<img height="35px" class="ico" src="https://img.icons8.com/BFCBCE/ios-filled/100/fridge.png" alt="fridge"/>
<div class="line"></div>
<h2 class="g topt">Storage</h2>
</div>
<div class="blur1"></div>

<div class="scroll">
  <div class="main">
    <div class="stored">
    
      <div class="ingre">
        <div class="g str">Pasta</div>
        <div class="g left">2 <span class="leftct">Days left</span></div>
        <img class="edit img" width="30" src="https://img.icons8.com/BFCBCE/ios-glyphs/100/pencil--v1.png" alt="pencil--v1"/>
        <img class="delete img" width="30" src="https://img.icons8.com/BFCBCE/material-rounded/100/waste.png" alt="waste"/>
        <div class="strip"></div>
      </div>
      

<div class="ingre">
        <div class="g str">Milk</div>
        <div class="g left">3 <span class="leftct">Days left</span></div>
        <img class="edit img" width="30" src="https://img.icons8.com/BFCBCE/ios-glyphs/100/pencil--v1.png" alt="pencil--v1"/>
        <img class="delete img" width="30" src="https://img.icons8.com/BFCBCE/material-rounded/100/waste.png" alt="waste"/>
        <div class="strip"></div>
      </div>







    </div>
  </div>
</div>


</g>
<div class="blur2"></div>
<div class="bottom" onclick="transitionToPage('./adding.html')">
<h2 class="g">Add ingredient</h2>
</div>
<div class="nav">
  <div class="b1"></div>
  <div class="r" onclick="transitionToPage('./calendar.html')">
    <img width="45" class="ca" src="https://img.icons8.com/BFCBCE/stamp/100/calendar.png" alt="calendar"/>
     <img width="45" class="ca c0" src="https://img.icons8.com/6f90af/stamp/100/calendar.png" alt="calendar"/>

  </div>
  <div class="c"></div>
  <div class="ct" onclick="transitionToPage('./recipe.html')">
    <img width="70" class="re" src="https://img.icons8.com/BFCBCE/ios-glyphs/100/cooking-book.png" alt="cooking-book"/>
        <img width="70" class="re c0" src="https://img.icons8.com/6f90af/ios-glyphs/100/cooking-book.png" alt="cooking-book"/>
  </div>
  <div class="l" onclick="transitionToPage('./profile.html')">
    <img width="50" class="us" src="https://img.icons8.com/6F90AF/ios-glyphs/100/user-male-circle.png" alt="user-male-circle"/>
        <img width="50" class="us c0" src="https://img.icons8.com/84A7BA/ios-glyphs/100/user-male-circle.png" alt="user-male-circle"/>
  </div>
  <div class="b2"></div>
</div>
<script src="date.js"></script>
</body>
<script>
      window.transitionToPage = function(href) {
    document.querySelector('.body').style.opacity = 0
    setTimeout(function() { 
        window.location.href = href
    }, 500)
}

document.addEventListener('DOMContentLoaded', function(event) {
    document.querySelector('.body').style.opacity = 1
})

// In your <script> or separate .js file:
function fetchIngredients() {
  const spId = localStorage.getItem("spId");
  if (!spId) {
    console.error("No session found.");
    return;
  }

  fetch("https://expirewise.localto.net/api/fetch_ingredients.php", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({ spId })
  })
  .then(r => r.json())
  .then(data => {
    if (data.error) {
      console.error(data.error);
      return;
    }

    const container = document.querySelector(".stored");
    container.innerHTML = "";  // clear old

    data.ingredients.forEach(ing => {
      const days = ing.days_left;
      // clamp at zero if already expired
      const displayDays = days < 0 ? 0 : days;

      container.insertAdjacentHTML("beforeend", `
        <div class="ingre">
          <div class="g str">${ing.name}</div>
          <div class="g left">
            ${displayDays}
            <span class="leftct">
              ${displayDays === 1 ? "Day" : "Days"} left
            </span>
          </div>
          <img class="edit img" width="30"
               src="https://img.icons8.com/BFCBCE/ios-glyphs/100/pencil--v1.png"
               alt="edit" />
          <img class="delete img" width="30"
               src="https://img.icons8.com/BFCBCE/material-rounded/100/waste.png"
               alt="delete" />
          <div class="strip"></div>
        </div>
      `);
    });
  })
  .catch(err => console.error("Fetch error:", err));
}

// Call on page load
document.addEventListener("DOMContentLoaded", fetchIngredients);

</script>
</html>